angular.module("pascalprecht.translate").provider("$translatePartialLoader",function(){function e(e,t){this.name=e;this.isActive=true;this.tables={};this.priority=t||0}e.prototype.parseUrl=function(e,t){return e.replace(/\{part\}/g,this.name).replace(/\{lang\}/g,t)};e.prototype.getTable=function(e,t,r,a,n,i){var o=t.defer();if(!this.tables[e]){var s=this;r(angular.extend({method:"GET",url:this.parseUrl(n,e)},a)).success(function(t){s.tables[e]=t;o.resolve(t)}).error(function(){if(i){i(s.name,e).then(function(t){s.tables[e]=t;o.resolve(t)},function(){o.reject(s.name)})}else{o.reject(s.name)}})}else{o.resolve(this.tables[e])}return o.promise};var t={};function r(e){return Object.prototype.hasOwnProperty.call(t,e)}function a(e){return angular.isString(e)&&e!==""}function n(e){if(!a(e)){throw new TypeError("Invalid type of a first argument, a non-empty string expected.")}return r(e)&&t[e].isActive}function i(e,t){for(var r in t){if(t[r]&&t[r].constructor&&t[r].constructor===Object){e[r]=e[r]||{};i(e[r],t[r])}else{e[r]=t[r]}}return e}function o(){var e=[];Object.keys(t).forEach(function(r){if(t[r].isActive){e.push(t[r])}});e.sort(function(e,t){return e.priority-t.priority});return e}this.addPart=function(n,i){if(!a(n)){throw new TypeError("Couldn't add part, part name has to be a string!")}if(!r(n)){t[n]=new e(n,i)}t[n].isActive=true;return this};this.setPart=function(n,i,o){if(!a(n)){throw new TypeError("Couldn't set part.`lang` parameter has to be a string!")}if(!a(i)){throw new TypeError("Couldn't set part.`part` parameter has to be a string!")}if(typeof o!=="object"||o===null){throw new TypeError("Couldn't set part. `table` parameter has to be an object!")}if(!r(i)){t[i]=new e(i);t[i].isActive=false}t[i].tables[n]=o;return this};this.deletePart=function(e){if(!a(e)){throw new TypeError("Couldn't delete part, first arg has to be string.")}if(r(e)){t[e].isActive=false}return this};this.isPartAvailable=n;this.$get=["$rootScope","$injector","$q","$http",function(s,l,u,f){var c=function(e){if(!a(e.key)){throw new TypeError("Unable to load data, a key is not a non-empty string.")}if(!a(e.urlTemplate)){throw new TypeError("Unable to load data, a urlTemplate is not a non-empty string.")}var t=e.loadFailureHandler;if(t!==undefined){if(!angular.isString(t)){throw new Error("Unable to load data, a loadFailureHandler is not a string.")}else t=l.get(t)}var r=[],n=u.defer(),s=o();angular.forEach(s,function(a,n){r.push(a.getTable(e.key,u,f,e.$http,e.urlTemplate,t));a.urlTemplate=e.urlTemplate});u.all(r).then(function(){var t={};angular.forEach(s,function(r){i(t,r.tables[e.key])});n.resolve(t)},function(){n.reject(e.key)});return n.promise};c.addPart=function(n,i){if(!a(n)){throw new TypeError("Couldn't add part, first arg has to be a string")}if(!r(n)){t[n]=new e(n,i);s.$emit("$translatePartialLoaderStructureChanged",n)}else if(!t[n].isActive){t[n].isActive=true;s.$emit("$translatePartialLoaderStructureChanged",n)}return c};c.deletePart=function(e,n){if(!a(e)){throw new TypeError("Couldn't delete part, first arg has to be string")}if(n===undefined){n=false}else if(typeof n!=="boolean"){throw new TypeError("Invalid type of a second argument, a boolean expected.")}if(r(e)){var i=t[e].isActive;if(n){var o=l.get("$translate");var u=o.loaderCache();if(typeof u==="string"){u=l.get(u)}if(typeof u==="object"){angular.forEach(t[e].tables,function(r,a){u.remove(t[e].parseUrl(t[e].urlTemplate,a))})}delete t[e]}else{t[e].isActive=false}if(i){s.$emit("$translatePartialLoaderStructureChanged",e)}}return c};c.isPartLoaded=function(e,r){return angular.isDefined(t[e])&&angular.isDefined(t[e].tables[r])};c.getRegisteredParts=function(){var e=[];angular.forEach(t,function(t){if(t.isActive){e.push(t.name)}});return e};c.isPartAvailable=n;return c}]});